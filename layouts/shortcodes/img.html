{{/*
Usage: {{< img src="/images/cat.jpg" alt="My Cat" width="800">}}
    Result: <img src="https://ik.imagekit.io/YOUR_ID/images/cat.jpg?tr=w-800,f-auto" ...>
    */}}

    {{ $src := .Get "src" }}
    {{ $alt := .Get "alt" }}
    {{ $width := .Get "width" | default "800" }}
    {{ $class := .Get "class" }}
    {{ $ik := .Site.Params.imagekit_url }}

    {{/* Logic: Only optimize local images (starting with /) */}}
    {{ $finalSrc := $src }}
    {{ if and $ik (hasPrefix $src "/") }}
    {{/* Remove leading slash for concatenation if needed, but ImageKit usually handles it.
    Let's construct: IK_URL + SRC + TRANSFORMATION */}}
    {{ $finalSrc = printf "%s%s?tr=w-%s,f-auto" $ik $src $width }}
    {{ end }}

    <img src="{{ $finalSrc }}" alt="{{ $alt }}" {{ with $class }}class="{{ . }}" {{ end }} width="{{ $width }}"
        loading="lazy" decoding="async">